{extend name="templates/public/base.html" /}
{block name="main"}
<style>
h3{
    color:grey;
}
</style>
<div class="layui-container">
  <!-- <div class="jumbotron"> -->
    <br />
    <h3 style="color:black"><i>{$projBase['name']}</i></h3>
    <hr />
    <h3 style="color:grey;">基础信息</h3><br />
    <table class="layui-table" lay-even lay-skin="nob">
        <colgroup>
          <col>
          <col>
        </colgroup>
        <tr>
            <td>类型</td>
            <td>{$projBase.cate_name}</td>
        </tr>
        <tr>
            <td>发起人</td>
            <td>{$leader.nickname}</td>
        </tr>
        <tr>
            <td>邮箱</td>
            <td>确认合作关系后可见</td>
        </tr>
        <tr><td colspan="2">简介：{$projBase.intro}</td></tr>
    </table>
    <h3>项目标签</h3>
    <p>/
    {volist name="tags" id="tag"}
        {$tag['name']}&nbsp;/
    {/volist}
    </p>
    <hr />
    <h3>需求角色</h3>
    {volist name="roleInfoList" id="roleInfo"}
    <p style="color:grey;text-align:center;">{$key}</p>    
        <table class="layui-table" lay-skin="nob">
            <colgroup>
              <col width="30">
              <col width="900">
            </colgroup>
            <thead>
              <tr>
                <th>技能</th>
                <th>等级（入门/熟练/精通）</th>
              </tr>
            </thead>
            <tbody>
                {volist name="roleInfo" id="skill"}
                <tr>
                    <td>{$skill.name}</td>
                    <td>
                        {switch name="skill['level']"}
                        {case value="1"}
                        <div class="layui-progress layui-progress-big">
                            <div class="layui-progress-bar layui-bg-orange" lay-percent="1/3"></div>
                        </div>
                        {/case}
                        {case value="2"}
                        <div class="layui-progress layui-progress-big">
                            <div class="layui-progress-bar layui-bg-blue" lay-percent="2/3"></div>
                        </div>
                        {/case}
                        {case value="3"}
                        <div class="layui-progress layui-progress-big">
                            <div class="layui-progress-bar" lay-percent="100%"></div>
                        </div>
                        {/case}
                        {default /}
                        {/switch}
                    </td>
                </tr>
                {/volist}
            </tbody>
        </table>

    {/volist}
  <!-- </div> -->
  <br />
  {eq name="has_join" value="1"}
  <h3>成员信息(项目内人员可见)</h3><br />
  {volist name="partners" id="partner"}
   <p><b><a href={:url('index/partner/view',"id=$partner[id]")}>{$partner.nickname}</a></b></p>
   <p>性别：{switch name="partner.sex"}
    {case value="1"}男{/case}
    {case value="2"}女{/case}
    {default /}未知
    {/switch}</p>
   <p>QQ：{$partner.qq}</p>
   <p>Email：{$partner.email}</p>
  {/volist}
  {else/}
    {eq name="has_apply_today" value="1"}
    <button class="btn btn-warning btn-block" disabled=true>今日已发出申请</button>
    {else/}
    <button class="btn btn-success btn-block" id="apply">申请加入</button>
    {/eq}
  {/eq}
  <br />
</div>
{/block}
{block name="free_js"}
{__block__}
<script>
layui.use(['layer','element'],function(){
    var layer = layui.layer;
    var element = layui.element;
    $("#apply").on('click',function(){
        layer.confirm("确认要申请加入该项目吗？",{icon: 3,offset:['30vh']},function(index){
            $("#apply").attr("disabled","true");
            $("#apply").text("今日已发出申请");
            $.get(
                '{:url("user/action/apply","id=$projBase[id]")}',
                function(data,status){
                    if(data == 0){
                        layer.msg('发起申请成功！',{icon: 1, time:2000,offset:['30vh']});
                    }else if(data == 1){
                        layer.msg('发起申请失败',{icon: 2,time:2000,offset:['30vh']});
                    }else if(data == 2){
                        layer.msg('发起申请成功，但由于内部错误，向对方发送通知邮件失败，如果一直遇到此问题请反馈给我们',{icon:4,offset:['30vh']});
                    }else if(data.code == 0){
                        layer.msg('您还未登录，请登录后再进行操作！',{icon:2,offset:['30vh']});
                    }else{
                        layer.msg('未捕获的错误，如果持续出现请联系我们',{icon: 2,time: 2000,offset:['30vh']});
                    }
                }
            );
            layer.close(index);
        });
    });
});
</script>
{/block}