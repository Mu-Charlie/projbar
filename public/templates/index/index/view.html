{extend name="templates/public/base.html" /}
{block name="main"}
<div class="layui-container">
  <!-- <div class="jumbotron"> -->
    <br />
    <h3 class="text-info">{$projBase['name']}</h3>
    <hr />
    <h3>基础信息</h3><br />
    <p>项目类型：
    {switch name="projBase['cate_id']"}
    {case value="1"}比赛{/case}    
    {case value="2"}外包{/case}
    {case value="3"}创业{/case}
    {case value="4"}实验课题{/case}
    {case value="5"}实践练手{/case}
    {case value="6"}比赛：国创{/case}
    {case value="7"}比赛：互联网+{/case}
    {case value="8"}比赛：数模{/case}
    {case value="10"}比赛：挑战杯{/case}
    {case value="11"}比赛：TI杯{/case}
    {case value="12"}比赛：其他{/case}
    {/switch}
    </p>
    <p>发起人：{$projBase['leader_id']}</p>
    <!-- <p>邮箱：{$projBase['email']}</p> -->
    <p>邮箱：确认合作关系后可见</p>
    <p>简介：{$projBase['intro']}</p>
    <hr />
    <h3>项目标签</h3>
    <p>/
    {volist name="tags" id="tag"}
        {$tag['name']}&nbsp;/
    {/volist}
    </p>
    <hr />
    <h3>需求角色</h3>
    {volist name="roleInfoList" id="roleInfo" key="k"}
        <p>角色{$k}：
            {switch name="key"}
                {case value="1"}开发&测试{/case}
                {case value="2"}产品&文案{/case}
                {case value="3"}设计&美工{/case}
                {case value="4"}运营&市场{/case}
                {default /}暂无
            {/switch}
        </p>
        {volist name="roleInfo" id="skill"}
        <p>
        ID：{$skill['id']}&emsp;技能：{$skill['name']}&emsp;等级：
            {switch name="skill['level']"}
                {case value="1"}入门
                <div class="layui-progress layui-progress-big">
                    <div class="layui-progress-bar layui-bg-orange" lay-percent="1/3"></div>
                </div>
                {/case}
                {case value="2"}熟练
                <div class="layui-progress layui-progress-big">
                    <div class="layui-progress-bar layui-bg-blue" lay-percent="2/3"></div>
                </div>
                {/case}
                {case value="3"}精通
                <div class="layui-progress layui-progress-big">
                    <div class="layui-progress-bar" lay-percent="100%"></div>
                </div>
                {/case}
                {default /}
            {/switch}
        </p>
        {/volist}
    {/volist}
  <!-- </div> -->
  <br />
  {eq name="has_join" value="1"}
  <h3>成员信息(项目内人员可见)</h3><br />
  {volist name="partners" id="partner"}
   <p><b><a href={:url('index/partner/view',"id=$partner[id]")}>{$partner.nickname}</a></b></p>
   <p>性别：{switch name="partner.sex"}
    {case value="1"}男{/case}
    {case value="2"}女{/case}
    {default /}未知
    {/switch}</p>
   <p>QQ：{$partner.qq}</p>
   <p>Email：{$partner.email}</p>
  {/volist}
  {else/}
    {eq name="has_apply_today" value="1"}
    <button class="btn btn-warning btn-block" disabled=true>今日已发出申请</button>
    {else/}
    <button class="btn btn-success btn-block" id="apply">申请加入</button>
    {/eq}
  {/eq}
  <br />
</div>
{/block}
{block name="free_js"}
{__block__}
<script>
layui.use(['layer','element'],function(){
    var layer = layui.layer;
    var element = layui.element;
    $("#apply").on('click',function(){
        layer.confirm("确认要申请加入该项目吗？",{icon: 3,offset:['30vh']},function(index){
            $("#apply").attr("disabled","true");
            $("#apply").text("今日已发出申请");
            $.get(
                '{:url("user/action/apply","id=$projBase[id]")}',
                function(data,status){
                    if(data == 0){
                        layer.msg('发起申请成功！',{icon: 1, time:2000});
                    }else if(data == 1){
                        layer.msg('发起申请失败',{icon: 2,time:2000});
                    }else if(data == 2){
                        layer.msg('发起申请成功，但由于内部错误，向对方发送通知邮件失败，如果一直遇到此问题请反馈给我们',{icon:4});
                    }else{
                        layer.msg('未捕获的错误，如果持续出现请联系我们',{icon: 2,time: 2000});
                    }
                }
            );
            layer.close(index);
        });
    });
});
</script>
{/block}