{extend name="templates/public/base.html" /}
{block name="cascade"}
<form class="layui-form layui-form-pane" action="{:url('index/index/filter')}" method="get">
<div class="layui-row">
    <div class="layui-input-inline layui-col-xs3">
    <select name="cate1" id="cate1" lay-filter="cate1">
        <option value="">性质</option>
        {volist name="firstCates" id="firstCate"}
        <option value="{$firstCate.id}">{$firstCate.name}</option>
        {/volist}
    </select>
    </div>
    <div class="layui-input-inline layui-col-xs3" lay-filter="typeRole">
    <select name="cate2" id="cate2">
    <!-- js -->
    </select>
    </div>
    <div class="layui-input-inline layui-col-xs3">
    <select name="role" id="role" lay-filter="typeRole">
        <option value="">角色</option>
        {volist name="roles" id="role"}
        <option value="{$role.id}">{$role.name}</option>
        {/volist}
    </select>
    </div>
    <div class="layui-inpuy-inline layui-col-xs3">
    <button class="layui-input" id="filter" lay-submit style="text-align:center;"><a id="filter_icon" class="glyphicon glyphicon-filter"></a></button>            
    </div>
</div>
</form>
<br />
{/block}
{block name="main"}
<div class="layui-container-fluid" id="list">
    <div class="layui-row layui-col-space12" id="main" style="margin-left:10px;margin-right:10px;margin-bottom:10px;">
        {volist name="projList" id="proj"}
        <div class="layui-col-md4 layui-col-xs12">
            <div class="proj" style="background-image:url({$proj.image});"> 
            <p><b>{$proj.cate_name} : {$proj.name}</b></p>
            <p>{$proj.intro}</p>
            <p><a style="color:#fff;" href={:url("index/index/view","id=$proj[id]")}>查看详情 »»»</a>&emsp;&emsp;</p>
            </div>
        </div>
        {/volist}
    </div>
    <div class="layui-container" align="center" id="paginate">{$projList->render()}</div>
</div>
{/block}
{block name="free_js"}
{__block__}
<script>
layui.use('form',function(){
    var form = layui.form;
    console.log(1);
    form.on('select(cate1)',function(data){
        console.log(1);
        if(data.value){
        $.get(
            "{:url('index/index/getChildType')}"+"?pid="+data.value,
            function(data){
                var optionStr = "";
                $.each(data,function(i,item){
                optionStr += "<option value='"+item.id+"'>"+item.name+"</option>";
                });
                $("#cate2").html('<option value="">次分类</option>'+optionStr);
                form.render();
            }
        );
        $("#filter_icon").attr("style","color: #ef5b25;")
        }
    });

    form.on('select(typeRole)',function(data){
        $("#filter_icon").attr('style',"color: #ef5b25");
    }
});
</script>
{/block}