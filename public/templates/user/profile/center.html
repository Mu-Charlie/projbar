{extend name="templates/public/base.html" /}
{block name="main"}
<style>
.p-base{
    font-size: 16px!important;
}
.p{
    font-size: 16px!important;
    color:grey!important;
}
.div-base{
    background-color:#444;
    color: #eee;
}
</style>
<br /><h1 align="center">个人中心</h1><br />
<div class="layui-container-fluid">
    <div style="background-size:contain;
    background-repeat:round;color:#eee;padding:20px;background-image:url(/static/images/proj_images/center.jpg)">
      <table class="layui-table" lay-size="sm" lay-skin="nob" style="background-color:inherit;color:#eee!important;font-weight:500!important;">
          <colgroup>
            <col width="200">
            <col width="900">
          </colgroup>
          <tbody>
            <tr>
              <td>用户名：</td>
              <td>{$user['username']}</td>
            </tr>
            <tr>
              <td>昵称：</td>
              <td>{$user['nickname']}</td>
            </tr>
            <tr>
              <td>性别：</td>
              <td>
                {switch name="user.sex"}
                {case value="1"}<i class="layui-icon" style="color:rgba(0, 162, 255, 0.651);">&#xe662;</i>{/case}
                {case value="2"}<i class="layui-icon" style="color:rgb(245, 94, 194)">&#xe661;</i>{/case}
                {default /}<i class="layui-icon" style="color:grey">&#xe607;</i>
                {/switch}
              </td>
            </tr>
            <tr>
              <td>手机：</td>
              <td>{$user['mobile']}</td>
            </tr>
            <tr>
              <td>QQ：</td>
              <td> {$user['qq']}</td>
            </tr>
            <tr>
              <td>邮箱：</td>
              <td>{$user['email']}</td>
            </tr>
            <tr>
              <td>额外：</td>
              <td>{$user['extra']}</td>
            </tr>
          </tbody>
      </table>
        <br />
        <p align="center">
          <a class="btn btn-primary btn-block" style="width:80vw;" href="{:url('edit_base')}">编辑基础信息</a>
          <a class="btn btn-warning btn-block" style="width:80vw;" href="{:url('pass_update')}">修改密码</a>
        </p>
    </div>
    <br />
</div>
<br />
<div class="layui-collapse" lay-filter="test">
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">通知消息</h2>
    <div class="layui-colla-content layui-show">
    {volist name="msgs" id="msg"}
        {switch name="msg['type']"}
        {case value="1"}
        <div>
        <p><a href={:url("index/partner/view","id=$msg[from_id]")}><b>{$msg.nickname}</b></a></p>&nbsp;        
          申请加入项目<a href={:url("index/index/view","id=$msg[proj_id]")}><b>{$msg.name}</b></a>
          <p>
            <!-- <a class="layui-btn ac-apply" href={:url('user/action/accept',"id=$msg[id]")}>接受</a>
            <a class="layui-btn layui-btn-danger" href={:url('user/action/refuse',"id=$msg[id]")}>拒绝</a> -->
            <button class="layui-btn accept" data-mid="{$msg['id']}">接受</button>
            <button class="layui-btn layui-btn-danger refuse" data-mid="{$msg['id']}">拒绝</button>
          </p>
          </div>
        {/case}
        {case value="2"}
        <div>
        <p><a href={:url("index/partner/view","id=$msg[from_id]")}><b>{$msg.nickname}</b></a></p>&nbsp;                
          邀请你加入项目<a href={:url("index/index/view","id=$msg[proj_id]")}><b>{$msg.name}</b></a>
          <p>
            <!-- <a class="layui-btn ac-invite" href={:url('user/action/accept',"id=$msg[id]")}>接受</a>
            <a class="layui-btn layui-btn-danger" href={:url('user/action/refuse',"id=$msg[id]")}>拒绝</a> -->
            <button class="layui-btn accept" data-mid="{$msg['id']}">接受</button>
            <button class="layui-btn layui-btn-danger refuse" data-mid="{$msg['id']}">拒绝</button>
          </p>
        </div>
        {/case}
        {case value="3"}
        <div>
        <p><a href={:url("index/partner/view","id=$msg[from_id]")}><b>{$msg.nickname}</b></a></p>&nbsp;                
          同意了您的请求，相关项目：<a href={:url("index/index/view","id=$msg[proj_id]")}><b>{$msg.name}</b></a>
          <p>
            <!-- <a class="layui-btn confirm" href={:url('user/action/confirm',"id=$msg[id]")}>我知道了</a> -->
            <button class="layui-btn confirm" data-mid="{$msg['id']}">我知道了</button>
          </p>
        </div>
        {/case}
        {case value="4"}
        <div>
        <p><a href={:url("index/partner/view","id=$msg[from_id]")}><b>{$msg.nickname}</b></a></p>&nbsp;                
          拒绝了您的请求，相关项目：<a href={:url("index/index/view","id=$msg[proj_id]")}><b>{$msg.name}</b></a>
          <p>
            <!-- <a class="layui-btn confirm" href={:url('user/action/confirm',"id=$msg[id]")}>我知道了</a> -->
            <button class="layui-btn confirm" data-mid="{$msg['id']}">我知道了</button>
          </p>          
        </div>
        {/case}
        {/switch}
    {/volist}
    {if condition="empty($msgs)"}<p>暂无消息</p>{/if}
    </div>
  </div>
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">技能信息</h2>
    <div class="layui-colla-content">
      {volist name="roleInfoList" id="roleInfo"}
      <p style="color:grey;">{$key}</p>    
          <table class="layui-table" lay-skin="nob">
              <colgroup>
                <col width="150">
                <col width="900">
              </colgroup>
              <thead>
                <tr>
                  <th>技能</th>
                  <th>等级（入门/熟练/精通）</th>
                </tr>
              </thead>
              <tbody>
                  {volist name="roleInfo" id="skill"}
                  <tr>
                      <td>{$skill.name}</td>
                      <td>
                          {switch name="skill['level']"}
                          {case value="1"}
                          <div class="layui-progress layui-progress-big">
                              <div class="layui-progress-bar layui-bg-orange" lay-percent="1/3"></div>
                          </div>
                          {/case}
                          {case value="2"}
                          <div class="layui-progress layui-progress-big">
                              <div class="layui-progress-bar layui-bg-blue" lay-percent="2/3"></div>
                          </div>
                          {/case}
                          {case value="3"}
                          <div class="layui-progress layui-progress-big">
                              <div class="layui-progress-bar" lay-percent="100%"></div>
                          </div>
                          {/case}
                          {default /}
                          {/switch}
                      </td>
                  </tr>
                  {/volist}
              </tbody>
          </table>
        {/volist}
        <p style="color:grey;">个人标签</p>      
        <p>
        {volist name="tags" id="tag"}
        {$tag['name']}&nbsp;/
        {/volist}
        </p>
        <p style="color:grey;">项目/实践经历</p>            
        <p>{$exp}</p>
        <br />
        <p><a class="btn btn-primary" href="{:url('edit_role')}">编辑角色信息</a></p>
    </div>
  </div>
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">我的项目</h2>
    <div class="layui-colla-content">
      <div class="layui-colla-item">
        {volist name="myProjList" id="myProj"}
        <p><b>{$myProj['cate_name']}：{$myProj['name']}</b></p>
        <p>项目简介：{$myProj['intro']}</p>
        <p><a class="btn btn-primary" href={:url('index/index/view',"id=$myProj[id]")}>查看详情 »</a></p>                
        <hr />
        {/volist}
      </div>
    </div>
  </div>
  <div class="layui-colla-item">
    <h2 class="layui-colla-title">联系我们</h2>
    <div class="layui-colla-content">
    <p>问题反馈&合作邮箱：vincentw23@foxmail.com</p>
    </div>
  </div>
</div>
{/block}
{block name="free_js"}
{__block__}
<script>
layui.use(['element','layer'],function(){
    var element = layui.element;
    var layer = layui.layer;

    //AJAX处理用户对于消息的处理
    //接受
    $(".accept").on('click',function(){
      var mid = $(this).attr('data-mid');
      layer.confirm("确认要接受该申请吗？",{icon:3,offset:['40vh']},function(index){
      layer.msg('接受成功！可在我的项目中查看详情',{icon: 1,time: 2000,offset:'40vh'});
      $(`[data-mid=${mid}]`).parent().parent().remove();
        $.get(
          '{:url("user/action/accept")}'+"?id="+mid,
          function(data,status){
            if(data == 1){
              layer.msg('接受失败：添加用户到项目组失败，如果一直遇到此问题，请联系我们！',{icon:2, offset:'40vh'});
            }else if(data == 2){
              layer.msg('接受失败：发送回复消息失败，如果您一直遇到此问题，请尽快反馈给我们',{icon:2, offset:'40vh'});
            }else if(data == 3){
              layer.msg('接受失败：更新消息处理状态失败,如果您一直遇到此问题，请尽快反馈给我们',{icon:2,offset:'40vh'});
            }else if(data == 4){
              layer.msg('操作授权错误',{icon:2,offset:'40vh'});
            }else if(data == 5){
              layer.msg('不受理的访问！',{icon:2,offset:'40vh'});
            }
          }
        );
      });
    });
    //拒绝申请/邀请
    $(".refuse").on('click',function(){
      var mid = $(this).attr('data-mid');
      layer.confirm("确认要拒绝该申请吗？",{icon:3,offset:['40vh']},function(index){
        layer.close(index);
        $(`[data-mid=${mid}]`).parent().parent().remove();
        layer.msg('已拒绝该请求',{icon: 1,time: 2000,offset:['40vh']});
        $.get(
          '{:url("user/action/refuse")}'+'?id='+mid,
          function(data,status){
            console.log(data);
            if(data != 0){
              layer.msg('内部错误：'+data,{icon:2, offset:['40vh']});
            }
          }
        );
      });
    });
    //我知道了
    $(".confirm").on('click',function(){
      var mid = $(this).attr('data-mid');
      $.get(
        '{:url("user/action/confirm")}'+'?id='+mid,
        function(data,status){
          if(data == 0){
            $(`[data-mid=${mid}]`).parent().parent().remove();
          }else{
            layer.msg('内部错误'+data,{icon:2, offset:['40vh']});
          }
        }
      );
    });
});
</script>
{/block}
  